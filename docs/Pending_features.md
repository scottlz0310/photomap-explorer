# 🚧 将来の拡張機能

## 基本操作の改善
- アドレスバーで直接フォルダパス入力が可能に。（実装済2025.06.24）フォルダジャンプ機能により廃止
- フォルダペインはツリー表示ではなく、パスに応じてカレントフォルダ直下のみをリスト表示する方式に変更（実装済2025.06.26）
- フォルダビューでフォルダをダブルクリックすると、そのフォルダに移動しアドレスバーも更新されるようにする（実装済2025.06.26）
- アドレスバーのフォルダをダブルクリックで対象フォルダに移動する（実装済2025.06.25）
- 「全ドライブに戻る」ボタンは「⬆️（親フォルダへ移動）」ボタンとして動作するように変更（実装済2025.06.26）
- CTRLクリックによる複数選択を実装し、左右カーソルキーや⬅️➡️ボタンによる選択画像の比較機能を追加
- 戻るボタンのUI見直し（フォルダペインの最上段に配置し、視線誘導を自然にする）（実装済2025.06.26）
- アドレスバーの区切り文字をなくしてボタンに枠を追加して可視化します。画面に収まらないときは子階層側を残し、ルート側を順に隠していく。

## 表示機能の強化
- サムネイルのサイズ変更（大・中・小）を表示メニューで調整可能に。(実装済2025.06.25)
- 全画面表示トグルをダブルクリックで切り替えられる。全画面ボタンとデフォルト表示に戻るボタンを設置。（実装済2025.06.26）
- ステータスバーに画像解像度、撮影日時、撮影情報（カメラ、シャッタースピード等）を統合表示。（実装済2025.06.26）
- ファイルやサムネイルエリアの並び順を簡単に切り替えられるようにする。そしてその順番は同期させる。（実装済2025.06.26）
- スライドスイッチによるダークモードの実装。スタイルシート使用。
- 中央ペインの最小幅はサムネイルサイズの値に連動するようにする

## ドラッグ＆ドロップ機能
- フォルダ選択・画像登録をドラッグ＆ドロップで簡略化。起動引数処理も参照。
- 他アプリへCTRL+CLKで選択した複数画像をドラッグ＆ドロップで他アプリに渡す。フォルダ移動も兼ねる。

## 最近の履歴管理
- 開いたフォルダ履歴をメニューやサイドバーで表示し、迅速なアクセスを提供。UI検討中

## 右クリックメニューの追加
- サムネイルやファイル選択部分に右クリックメニューを追加し、操作を簡素化。
    プロパティ、削除、切り取り、コピー、等
- フォルダの作成や画像のコピー、移動、削除などを可能に
    右クリックメニューと同義

## AI活用と画像フィルタリング
- 画像の特徴（色、構図、被写体）を基にAIが似た画像を選別。
    マスキングエリアを設定し、周辺部重視で似た画像をピックアップするなど。
- ジオタグを活用した撮影位置範囲の絞り込みとマップ表示の強化。
    MAPをドラッグで選択し、範囲内の画像を自動で選択状態に。

## 追加機能の検討
- メニューバーの導入（ファイル・表示・設定など基本構成）。
- 起動引数を利用してフォルダ/ファイルへの自動遷移を実現。

## 第2回コードリファクタリング計画（全体設計）

### 🎯 現在の問題点

#### 1. 構造的問題
- `window/main_window.py` (266行) が肥大化
- `ui/`ディレクトリ内の責任範囲が曖昧
- 一部のUIコンポーネントが単機能ファイルに散らばっている
- `logic/`とUIの境界が不明確

#### 2. アーキテクチャ的問題
- MVCパターンやMVVMパターンが未適用
- 依存関係が複雑（循環参照の可能性）
- テスタビリティが低い
- 設定管理機能がない

### 🗂️ 提案する新しいディレクトリ構造

```
photomap-explorer/
├── main.py                     # エントリーポイント
├── app/                        # アプリケーション層
│   ├── __init__.py
│   ├── application.py          # アプリケーション制御
│   └── config.py               # 設定管理
├── domain/                     # ドメイン層（ビジネスロジック）
│   ├── __init__.py
│   ├── models/                 # データモデル
│   │   ├── __init__.py
│   │   ├── image.py            # 画像データモデル
│   │   ├── location.py         # GPS位置情報モデル
│   │   └── folder.py           # フォルダモデル
│   ├── services/               # サービス層
│   │   ├── __init__.py
│   │   ├── image_service.py    # 画像処理サービス
│   │   ├── gps_service.py      # GPS処理サービス
│   │   └── map_service.py      # 地図生成サービス
│   └── repositories/           # データアクセス層
│       ├── __init__.py
│       ├── image_repository.py # 画像データアクセス
│       └── folder_repository.py# フォルダデータアクセス
├── presentation/               # プレゼンテーション層
│   ├── __init__.py
│   ├── controllers/            # コントローラー
│   │   ├── __init__.py
│   │   ├── main_controller.py  # メインウィンドウ制御
│   │   ├── image_controller.py # 画像表示制御
│   │   └── map_controller.py   # 地図制御
│   ├── views/                  # ビュー（UIコンポーネント）
│   │   ├── __init__.py
│   │   ├── main_window.py      # メインウィンドウ
│   │   ├── panels/             # パネルコンポーネント
│   │   │   ├── __init__.py
│   │   │   ├── folder_panel.py
│   │   │   ├── thumbnail_panel.py
│   │   │   ├── preview_panel.py
│   │   │   └── map_panel.py
│   │   ├── controls/           # コントロール
│   │   │   ├── __init__.py
│   │   │   ├── address_bar.py
│   │   │   ├── toolbar.py
│   │   │   └── status_bar.py
│   │   └── dialogs/            # ダイアログ
│   │       ├── __init__.py
│   │       └── settings_dialog.py
│   └── viewmodels/             # ビューモデル（MVVM用）
│       ├── __init__.py
│       ├── main_viewmodel.py
│       └── image_viewmodel.py
├── infrastructure/             # インフラ層
│   ├── __init__.py
│   ├── file_system.py          # ファイルシステムアクセス
│   ├── exif_reader.py          # Exif読み取り
│   └── map_generator.py        # 地図HTML生成
├── utils/                      # ユーティリティ
│   ├── __init__.py
│   ├── constants.py            # 定数
│   ├── helpers.py              # ヘルパー関数
│   └── exceptions.py           # カスタム例外
└── tests/                      # テスト
    ├── __init__.py
    ├── unit/
    ├── integration/
    └── fixtures/
```

### 🚀 段階的実装計画

#### Phase 1: 基盤整備
1. ✅ **新ディレクトリ構造作成**
2. ✅ **設定管理システム導入** (`app/config.py`)
3. ✅ **カスタム例外クラス定義** (`utils/exceptions.py`)
4. ✅ **定数・ヘルパー関数整理** (`utils/`)
5. ✅ **アプリケーション制御クラス実装** (`app/application.py`)
6. ✅ **ドメインモデル作成** (`domain/models/photo.py`, `photo_collection.py`)
7. ✅ **リポジトリインターフェース定義** (`domain/repositories/photo_repository.py`)
8. ✅ **ドメインサービス実装** (`domain/services/photo_domain_service.py`)

**Phase 1完了！** 基盤となるアーキテクチャとドメイン層の骨格が整いました。

#### Phase 2: ドメイン層分離
1. ✅ **データモデル作成** (`domain/models/`)
2. ✅ **サービス層実装** (`domain/services/`)
3. ✅ **リポジトリ層実装** (`domain/repositories/`)
4. ✅ **現在の`logic/image_utils.py`をサービス層に移行**
5. ✅ **インフラ層実装** (`infrastructure/`)
   - ✅ **EXIF読み取り** (`exif_reader.py`)
   - ✅ **ファイルシステムアクセス** (`file_system.py`)
   - ✅ **地図生成** (`map_generator.py`)
   - ✅ **リポジトリ具象実装** (`repositories.py`)

**Phase 2完了！** 既存のビジネスロジックが新しいアーキテクチャに統合されました。

#### Phase 3: プレゼンテーション層リファクタリング
1. ✅ **ビューモデル導入** (`presentation/viewmodels/`)
2. ✅ **コントローラー分離** (`presentation/controllers/`)
3. ✅ **UIコンポーネント再編成** (`presentation/views/`)
4. ✅ **既存`ui/`ディレクトリから新構造へ移行**

#### Phase 4: インフラ層整備
1. ✅ **外部依存関係の分離** (`infrastructure/`)
2. ✅ **テスタビリティ向上**
3. ✅ **設定の外部化**

#### Phase 5: 品質向上
1. ✅ **ユニットテスト導入** (`tests/`)
2. ✅ **統合テスト実装**
3. ✅ **コードカバレッジ測定**
4. ✅ **CI/CD環境整備**

### 🏗️ 主要な設計原則

#### 1. Clean Architecture
- 依存関係の方向を明確に定義
- ビジネスロジックをUIから完全分離
- 外部依存関係の抽象化

#### 2. SOLID原則の適用
- **Single Responsibility**: 各クラスは単一の責任
- **Open/Closed**: 拡張に開いて修正に閉じる
- **Liskov Substitution**: サブタイプで置換可能
- **Interface Segregation**: インターフェースの分離
- **Dependency Inversion**: 依存関係の逆転

#### 3. Design Patterns
- **MVP/MVVM**: UI分離
- **Repository Pattern**: データアクセス抽象化
- **Service Pattern**: ビジネスロジック集約
- **Factory Pattern**: オブジェクト生成
- **Observer Pattern**: イベント通知

### 🎯 期待される効果

#### 開発効率
- 🚀 **機能追加が容易**：モジュラー設計
- 🔧 **保守性向上**：責任範囲の明確化
- 🐛 **デバッグ効率化**：レイヤー分離

#### 品質向上
- ✅ **テスタビリティ**：依存関係の分離
- 🔒 **安定性**：インターフェース設計
- 📈 **スケーラビリティ**：Clean Architecture

#### チーム開発
- 👥 **並行開発**：モジュール独立性
- 📚 **可読性**：明確な構造
- 🎓 **学習コスト軽減**：標準的なパターン

### ⚠️ 実装上の注意点

1. **段階的移行**：一度にすべて変更せず、段階的に実施
2. **後方互換性**：既存機能の維持
3. **テスト駆動**：各段階でテスト実装
4. **ドキュメント更新**：アーキテクチャ変更の記録
